---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
# ExternalSecret for APC NMC host credentials
#
# This pulls credentials from 1Password for your APC NMC device.
#
# Required fields in 1Password:
#   APC_HOSTNAME         - Hostname or IP address of the APC NMC
#   APC_USERNAME         - Admin username for the APC NMC
#   APC_PASSWORD         - Password for the APC NMC
#   APC_FINGERPRINT      - SSH host key fingerprint for the APC NMC
#   APC_INSECURE_CIPHER  - Set to "true" for older APC devices (optional, defaults to "false")
#
# Example 1Password item structure:
#   Item name: apc-ups-main
#   Fields:
#     - APC_HOSTNAME: 10.32.8.58
#     - APC_USERNAME: apc
#     - APC_PASSWORD: your-secure-password
#     - APC_FINGERPRINT: 4sd7MpvwhQrOEhAIjlL5Cr2s6ml0c22KX0rxYClwbN8
#     - APC_INSECURE_CIPHER: true
#
# To get the SSH fingerprint for APC devices, run:
#   ssh -o KexAlgorithms=+diffie-hellman-group1-sha1,diffie-hellman-group14-sha1 \
#       -o HostKeyAlgorithms=+ssh-rsa \
#       -o PubkeyAcceptedAlgorithms=+ssh-rsa \
#       -v apc@<hostname> exit 2>&1 | grep "Server host key"
#
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: apc-cr-main-ups
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: apc-cr-main-ups
  dataFrom:
    - extract:
        key: cr-main-ups
