---
apiVersion: v1
kind: ConfigMap
metadata:
  name: snmp-exporter-config
  namespace: observability
data:
  snmp.yml: |-
    # SNMP Exporter configuration for APC UPS monitoring
    # Based on https://github.com/prometheus/snmp_exporter/blob/main/snmp.yml
    auths:
      public_v2:
        community: public
        security_level: noAuthNoPriv
        auth_protocol: MD5
        priv_protocol: DES
        version: 2
    modules:
      apcups:
        walk:
          - 1.3.6.1.4.1.318.1.1.1.2    # PowerNet-MIB::upsBattery
          - 1.3.6.1.4.1.318.1.1.1.3    # PowerNet-MIB::upsInput
          - 1.3.6.1.4.1.318.1.1.1.4    # PowerNet-MIB::upsOutput
          - 1.3.6.1.4.1.318.1.1.1.7.2  # PowerNet-MIB::upsAdvConfig
          - 1.3.6.1.4.1.318.1.1.1.8    # PowerNet-MIB::upsComm
          - 1.3.6.1.4.1.318.1.1.1.12   # PowerNet-MIB::upsOutletGroups
        metrics:
          - name: upsBatteryStatus
            oid: 1.3.6.1.4.1.318.1.1.1.2.1.1
            type: gauge
            help: The status of the UPS batteries - 1.3.6.1.4.1.318.1.1.1.2.1.1
          - name: upsSecondsOnBattery
            oid: 1.3.6.1.4.1.318.1.1.1.2.1.2
            type: gauge
            help: Time on battery in seconds - 1.3.6.1.4.1.318.1.1.1.2.1.2
          - name: upsEstimatedMinutesRemaining
            oid: 1.3.6.1.4.1.318.1.1.1.2.2.3
            type: gauge
            help: Estimated runtime remaining in minutes - 1.3.6.1.4.1.318.1.1.1.2.2.3
          - name: upsEstimatedChargeRemaining
            oid: 1.3.6.1.4.1.318.1.1.1.2.2.1
            type: gauge
            help: Estimated battery charge remaining (%) - 1.3.6.1.4.1.318.1.1.1.2.2.1
          - name: upsBatteryVoltage
            oid: 1.3.6.1.4.1.318.1.1.1.2.2.8
            type: gauge
            help: Battery voltage - 1.3.6.1.4.1.318.1.1.1.2.2.8
          - name: upsBatteryTemperature
            oid: 1.3.6.1.4.1.318.1.1.1.2.2.2
            type: gauge
            help: Battery temperature in Celsius - 1.3.6.1.4.1.318.1.1.1.2.2.2
          - name: upsInputVoltage
            oid: 1.3.6.1.4.1.318.1.1.1.3.2.1
            type: gauge
            help: Input voltage - 1.3.6.1.4.1.318.1.1.1.3.2.1
          - name: upsInputFrequency
            oid: 1.3.6.1.4.1.318.1.1.1.3.2.4
            type: gauge
            help: Input frequency in Hz - 1.3.6.1.4.1.318.1.1.1.3.2.4
          - name: upsOutputVoltage
            oid: 1.3.6.1.4.1.318.1.1.1.4.2.1
            type: gauge
            help: Output voltage - 1.3.6.1.4.1.318.1.1.1.4.2.1
          - name: upsOutputFrequency
            oid: 1.3.6.1.4.1.318.1.1.1.4.2.2
            type: gauge
            help: Output frequency in Hz - 1.3.6.1.4.1.318.1.1.1.4.2.2
          - name: upsOutputLoad
            oid: 1.3.6.1.4.1.318.1.1.1.4.2.3
            type: gauge
            help: Output load as percentage of capacity - 1.3.6.1.4.1.318.1.1.1.4.2.3
          - name: upsOutputCurrent
            oid: 1.3.6.1.4.1.318.1.1.1.4.2.4
            type: gauge
            help: Output current in amps - 1.3.6.1.4.1.318.1.1.1.4.2.4
