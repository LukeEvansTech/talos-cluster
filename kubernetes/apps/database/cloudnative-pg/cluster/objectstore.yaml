---
# yaml-language-server: $schema=https://raw.githubusercontent.com/cloudnative-pg/plugin-barman-cloud/v0.9.0/config/crd/bases/barmancloud.cnpg.io_objectstores.yaml
apiVersion: barmancloud.cnpg.io/v1
kind: ObjectStore
metadata:
  name: postgres18-minio
spec:
  # Retention policy
  retentionPolicy: 90d

  # Barman configuration
  configuration:
    # S3 destination (MinIO)
    destinationPath: s3://cnpg/
    endpointURL: https://minio.${SECRET_INTERNAL_DOMAIN}:9000

    # Credentials from existing secret
    s3Credentials:
      accessKeyId:
        name: cloudnative-pg-secret
        key: AWS_ACCESS_KEY_ID
      secretAccessKey:
        name: cloudnative-pg-secret
        key: AWS_SECRET_ACCESS_KEY

    # WAL configuration
    wal:
      compression: zstd
      maxParallel: 4

    # Data backup configuration
    data:
      compression: bzip2
      jobs: 2
